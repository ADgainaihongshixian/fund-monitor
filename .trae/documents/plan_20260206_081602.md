# 403 Forbidden错误解决方案（跨域问题）

## 问题分析

用户反馈仍然报相同的403 Forbidden错误，这确实是由于跨域资源共享(CORS)问题导致的。新浪财经API对直接的跨域请求有严格限制，即使添加了Referer和User-Agent头也无法解决。

## 解决方案

### 使用Vite开发服务器代理

最可靠的解决方案是使用Vite的开发服务器代理功能来转发API请求，这样可以避免跨域问题。

### 实施步骤

#### 步骤1：配置Vite代理

修改`vite.config.ts`文件，添加代理配置：

```typescript
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

// https://vitejs.dev/config/
export default defineConfig({
  plugins: [react()],
  server: {
    proxy: {
      '/api/sina': {
        target: 'https://hq.sinajs.cn',
        changeOrigin: true,
        rewrite: (path) => path.replace(/^\/api\/sina/, ''),
        headers: {
          'Referer': 'https://finance.sina.com.cn/',
          'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36'
        }
      },
      '/api/eastmoney': {
        target: 'https://fundsuggest.eastmoney.com',
        changeOrigin: true,
        rewrite: (path) => path.replace(/^\/api\/eastmoney/, ''),
        headers: {
          'Referer': 'https://fund.eastmoney.com/',
          'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36'
        }
      },
      '/api/fund': {
        target: 'https://api.fund.eastmoney.com',
        changeOrigin: true,
        rewrite: (path) => path.replace(/^\/api\/fund/, ''),
        headers: {
          'Referer': 'https://fund.eastmoney.com/',
          'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36'
        }
      }
    }
  }
})
```

#### 步骤2：修改API基础URL

修改`api.ts`文件，更新API基础URL为相对路径：

```typescript
// API基础URL - 使用Vite代理
const BASE_URL = '/api/sina';

// 基金搜索API基础URL - 使用Vite代理
const SEARCH_BASE_URL = '/api/eastmoney';

// 基金历史数据API基础URL - 使用Vite代理
const HISTORY_BASE_URL = '/api/fund';
```

#### 步骤3：测试验证

1. 重新运行开发服务器
2. 检查接口是否能够正常返回数据
3. 验证界面显示是否正常

## 预期结果

- 接口能够正常返回基金实时估值数据
- 不再出现403 Forbidden错误
- 界面能够正确显示基金数据
- 错误处理机制能够正确处理其他可能的错误情况