# 基金历史数据接口优化方案

## 问题分析

用户反馈`getFundHistory`接口有问题，需要确保它能够正确获取和处理走势图所需的数据。通过分析代码，我发现了以下需要优化的地方：

### 1. 数据格式分析

- **当前实现**：
  - 使用新浪财经的API：`/list=f_${code}`
  - 返回CSV格式的数据
  - 解析后提取日期、净值和涨跌幅信息

- **走势图需求**：
  - 需要清晰的日期字段
  - 需要准确的净值数据
  - 需要涨跌幅信息（可选）
  - 数据需要按日期排序
  - 需要足够的数据点以保证曲线平滑

### 2. 可能的问题

- **数据字段不完整**：可能缺少走势图所需的某些字段
- **数据解析逻辑**：可能存在解析错误或数据丢失
- **数据量不足**：可能返回的数据点不够，导致曲线不平滑
- **数据格式不符合要求**：可能与前端走势图组件的期望格式不匹配

## 解决方案

### 1. 优化getFundHistory接口

#### 步骤1：增强数据解析逻辑
- 确保能够正确解析新浪财经API返回的CSV格式数据
- 处理可能的数据格式异常
- 确保日期、净值和涨跌幅字段能够正确提取

#### 步骤2：优化数据处理
- 确保数据按日期正确排序（从旧到新）
- 确保返回足够的数据点，根据days参数调整
- 处理可能的数据缺失情况

#### 步骤3：添加数据验证
- 验证返回的数据是否符合走势图的要求
- 添加错误处理和日志记录
- 确保接口在数据异常时能够优雅降级

### 2. 实施计划

1. **修改getFundHistory方法**：
   - 增强数据解析逻辑
   - 优化数据处理流程
   - 添加数据验证和错误处理

2. **测试验证**：
   - 测试接口是否能够正常返回数据
   - 验证数据格式是否符合走势图要求
   - 确保曲线图能够正常显示

## 预期结果

- 接口能够稳定获取基金历史数据
- 数据格式符合走势图的要求
- 曲线图能够正常显示基金净值变化
- 接口能够处理各种异常情况