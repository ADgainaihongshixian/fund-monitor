# API接口替换计划

## 任务分析

**目标：** 将现有的新浪财经API接口替换为天天基金网的实时估值API接口。

**现有代码分析：**

* 文件：`d:\fundMonitor\src\services\api.ts`

* 方法：`getFundData`

* 功能：获取多个基金的实时数据

* 现有API：新浪财经API `/api/sina/list=f_{fundCode}`

* 返回格式：文本格式，需要解析

* 数据结构：返回包含多个基金数据的数组

**新接口分析：**

* API：`http://fundgz.1234567.com.cn/js/{fundCode}.js`

* 返回格式：JSONP格式

* 特点：一次只能查询一个基金

* 字段映射：

  * dwjz → netValue

  * gsz → estimateValue

  * gszzl → estimateChange

  * gztime → lastUpdate

## 解决方案

### 1. 核心改动

**修改`getFundData`方法：**

* 改为循环调用天天基金网API获取每个基金的数据

* 实现JSONP响应解析

* 保持原有的数据结构和返回格式

* 保留错误处理和缓存机制

### 2. 技术实现

**JSONP解析：**

* 解析返回的JSONP格式数据

* 提取核心JSON数据

* 处理可能的格式异常

**批量请求处理：**

* 对输入的基金代码数组进行循环处理

* 并行发送多个API请求以提高性能

* 汇总处理所有请求结果

**数据转换：**

* 将新接口的字段映射到原有数据结构

* 确保数据类型和格式一致

* 保持原有的计算逻辑

### 3. 保持兼容性

**缓存机制：**

* 保留现有的缓存逻辑

* 确保缓存键和缓存过期时间设置正确

**错误处理：**

* 保持原有的错误处理机制

* 处理新接口可能出现的错误情况

* 确保错误信息格式一致

**返回格式：**

* 保持原有的API响应格式

* 确保`ApiResponse<FundData[]>`结构不变

* 维持成功/失败的判断逻辑

## 实现步骤

1. **修改API基础URL：** 更新BASE\_URL或添加新的BASE\_URL
2. **重构getFundData方法：** 实现新接口的调用和数据处理
3. **实现JSONP解析：** 添加JSONP响应的解析逻辑
4. **批量请求处理：** 实现多基金代码的并行请求
5. **数据映射：** 按照字段映射关系转换数据
6. **缓存和错误处理：** 确保兼容性
7. **测试验证：** 确保功能正常工作

## 预期效果

* 接口替换后功能保持不变

* 能够获取到当日的实时估值数据

* 保持原有的错误处理和缓存机制

* 维持相同的返回数据结构

* 性能不受明显影响

